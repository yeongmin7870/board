<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <title>ë‚´ê°€ ì“´ ê¸€ë“¤</title>
</head>

<body>
    <% let address=board.result[0].user_address.split(' ');
            address = address[0]+' '+address[1]+' '+address[2];    
        %> <!-- ì£¼ì†Œ ìë¥´ê¸° -->
        <div style="text-align: left; margin-left: 10%; margin-right: 10%; margin-top: 5%;">
            <hr>
            <h4>ë§ˆì´í˜ì´ì§€</h4>
            <button type="button" class="btn btn-outline-primary" onClick="location.href=' /v2/home/0'">í™ˆìœ¼ë¡œ</button>

        <hr>
        <span>
            <% if(board.result[0].user_profile) { %>
                <img style="width: 30%; height: 30%;" src="/images/board/<%=board.result[0].user_profile%>">
                <!-- í”„ë¡œíŒŒì¼ -->
                <% } else { %>
                    <img style="width:  30%; height: 30%;" src="/images/profile.png">
                    <% } %>
                        <input id="nowNickname" type="hidden" value="<%=board.result[0].nickname%>">
                        <!-- í˜„ì¬ ëˆ„êµ¬ì˜ ë§ˆì´í˜ì´ì§€ë¥¼ ë³´ê³  ìˆëŠ”ì§€ -->
                        <button id="btn_profile" class="btn btn-outline-secondary">ìˆ˜ì •</button>
        </span>
        <ul>
            <li>ë‹‰ë„¤ì„: <%=board.result[0].nickname%>
            </li> <!-- ë‹‰ë„¤ì„ -->
            <li>ì£¼ì†Œ: <%=address%>
            </li> <!-- ì£¼ì†Œ -->
        </ul>
        <hr>

        <div id="btn_group">
            <button type="button" class="btn btn-outline-success" id="btn_all"
                onclick="buttonDisabled(this,'btn_group')" value="ì „ì²´" disabled>ì „ì²´</button>
            <button type="button" class="btn btn-outline-success" id="btn_sell"
                onclick="buttonDisabled(this,'btn_group')" value="íŒë§¤">íŒë§¤ì¤‘</button>
            <button type="button" class="btn btn-outline-success" id="btn_reservation"
                onclick="buttonDisabled(this,'btn_group')" value="ì˜ˆì•½">ì˜ˆì•½ì¤‘</button>
            <button type="button" class="btn btn-outline-success" id="btn_soldout"
                onclick="buttonDisabled(this,'btn_group')" value="íŒë§¤ì™„ë£Œ">íŒë§¤ì™„ë£Œ</button>
        </div>
        <p>ğŸˆ íŒë§¤ìƒí’ˆë³´ê¸°</p>
        <hr>

        <div style="text-align: center; clear: both;" id="mypage_board_content">
            <!--ì´ ì•ˆì€ í•´ë‹¹ ë‹‰ë„¤ì„ ê²Œì‹œíŒ -->
        </div>
        <!-- css float ì—¬ê¸°ì„œë¶€í„°  clear í•´ë²„ë¦¼ -->
        <div id="nav_bar_btn_group" style="clear:both;">
            <hr>
            <div id="div_numberbar_arrow"> <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” --></div>
            <hr>
        </div>
        </div>

        <script src="/javascripts/cookie.js" type="text/javascript"></script>
        <script src="/javascripts/fetch.js" type="text/javascript"></script>
        <script>
            let token = getCookie('x_auth'); //í† í° êº¼ë‚´ê¸°
            let btn_profile = document.getElementById("btn_profile"); // ìˆ˜ì •ë²„íŠ¼
            let newContentDiv = ""; // ë§ˆì´í˜ì´ì§€ ê²Œì‹œë¬¼ ë‚´ìš© ìì‹ div
            let current_page = 0; // ê²Œì‹œíŒ ë‚´ìš© ë³´ê³  ìˆëŠ” í˜„ì¬ í˜ì´ì§€
            let div_numberbar_arrow = document.getElementById("div_numberbar_arrow"); // í˜ì´ì§€ ìˆ«ì ë§‰ëŒ€ê¸°ë‘, ì´ì „í˜ì´ì§€, ë‹¤ìŒí˜ì´ì§€ ë²„íŠ¼ div
            let div_new_numberbar_arrow = ""; // div_numberbar_arrow ìì‹ div
            const nowNickname = document.getElementById("nowNickname"); //í˜„ì¬ ë‹‰ë„¤ì„ input
            const mypageNickname = nowNickname.value; //ë§ˆì´í˜ì´ì§€ ë‹‰ë„¤ì„
            let mypage_board_content = document.getElementById("mypage_board_content"); // ë§ˆì´í˜ì´ì§€ ê²Œì‹œë¬¼ ë‚´ìš© ë¶€ëª¨ div
            let btn_board_state = "ì „ì²´"; // í˜„ì¬ ë‚´ê°€ ì–´ë–¤ ê²Œì‹œíŒ ìƒíƒœ ë²„íŠ¼ì„ ëˆŒë €ëŠ”ì§€ í™•ì¸í•˜ëŠ” ë³€ìˆ˜;
            let url = ""; // ë§ˆì´í˜ì´ì§€ ê²Œì‹œíŒ ë‚´ìš©ë¬¼ ë° ë„¤ë¹„ê²Œì´ì…˜ ë°” ì£¼ì†Œë¥¼ ë‹´ëŠ” ê°’

            /** í† í°ì„ ë°›ìœ¼ë©´ ë‹‰ë„¤ì„ìœ¼ë¡œ í”„ë¡œí•„ ìˆ˜ì •ê¶Œí•œì„ ì²´í¬ í•´ì£¼ê³ 
             *  ë§ë‹¤ë©´ ìˆ˜ì • íŒì—…ì°½ì„ ë³´ì—¬ì£¼ëŠ” í•¨ìˆ˜
             */
            btn_profile.addEventListener("click", async () => {
                const t = await Post_body("/v1/getnickname?_method=GET", { data: token }); // í† í°ìœ¼ë¡œ ê°€ì ¸ì˜¨ ë‹‰ë„¤ì„
                const tokenNickname = t.nickname;
                if (tokenNickname == mypageNickname) {
                    window.open("/v2/profile-popup", "í”„ë¡œíŒŒì¼ ìˆ˜ì •", "width=400, height=300, top=10, left=10");
                } else {
                    alert("ìì‹ ì˜ ë§ˆì´í˜ì´ì§€ê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— í”„ë¡œíŒŒì¼ì„ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                }
            })
            /** í´ë¦­í•œ ë²„íŠ¼ ì•„ì´ë””ë¥¼ ì…ë ¥ë°›ìœ¼ë©´
             *  í•œë²ˆ ì „ë¶€ ë¹„í™œì„±í™” í’€ì–´ì£¼ê³ 
             *  í´ë¦­í•œ ë²„íŠ¼ì„ ë¹„í™œì„±í™” ì‹œí‚´
             */
            function buttonDisabled(b, c) {
                const target = document.getElementById(b.id);
                let childBtn = document.getElementById(`${c}`).getElementsByTagName('*');
                for (let btn of childBtn) {
                    btn.disabled = false;
                }
                target.disabled = true;
                btn_getContent(target);
            }
            /**ë²„íŠ¼ ëˆ„ë¥´ë©´ í•´ë‹¹ ë‚´ìš©ì„ ê°€ì ¸ì˜´*/
            async function btn_getContent(btn) {
                if (btn.value) {
                    btn_board_state = btn.value; // í˜„ì¬ ì„ íƒí•œ ê²Œì‹œíŒ ìƒíƒœ ë¶„ë¥˜ ë²„íŠ¼ ì €ì¥
                    current_page = 0; // ê²Œì‹œíŒ ìƒíƒœ ë¶„ë¥˜ ë²„íŠ¼ì„ ì„ íƒí–ˆìœ¼ë¯€ë¡œ í˜„ì¬í˜ì´ì§€ë¥¼ ë‹¤ì‹œ 0ìœ¼ë¡œ ë§Œë“¤ì–´ì¤Œ
                }

                url = `/v3/board-mypage-content/${nowNickname.value}?board_state=${btn_board_state}&&current_page=${current_page}`
                const content = await Get_pathVar(url);

                deleteBtnDiv();
                makeNavigationBar(content.numberbar_arrow);

                deleteDiv(); // ê¸°ì¡´ì— ìš”ì†Œê°€ ìˆë‹¤ë©´ ì‚­ì œ
                makeboardContent(content.board.result);

            }

            /** ìµœì´ˆì˜ í•œë²ˆë§Œ ì‹¤í–‰ 
             *  ì „ì²´ ê²Œì‹œíŒ ë‚´ìš© ê°€ì ¸ì˜¤ê¸°
            */
            async function all_getContent() {
                url = `/v3/board-mypage-content/${nowNickname.value}?board_state=ì „ì²´&&current_page=${current_page}`
                const content = await Get_pathVar(url);

                makeboardContent(content.board.result);

                makeNavigationBar(content.numberbar_arrow);

            }
            /** ë§ˆì´í˜ì´ì§€ ê³ ê°ì´ ì‘ì„±í•œ ê²Œì‹œë¬¼ ì¶œë ¥ í•´ì£¼ëŠ” í•¨ìˆ˜*/
            function makeboardContent(content) {
                if (content.length != 0) { //í…Œì´ë¸” í—¤ë“œ

                    for (let i = 0; i < content.length; i++) { // í…Œì´ë¸” ë³¸ì²´ 
                        let content_html = `
                                <div id="div_boardImage_${content[i].board_id}" style="float: left; width: 33%;">
                                    <a style="text-decoration: none;" href="/v3/board/page/${content[i].board_id}">
                                    <div style="position:relative">
                                        <p style="color:gray; position: absolute; top: 50%; left: 47%;">${content[i].board_state}<p>
                                        <img src="/images/board/${content[i].board_image}" style="width:50%; height:50%;">
                                    </div>
                                    <p style="color: black;">${content[i].board_title}</p></a> 
                                    <input type="hidden" value="${content[i].board_state}" id="input_boardImage_${content[i].board_id}">
                                </div>
                        `;

                        newContentDiv = document.createElement("div");
                        newContentDiv.innerHTML = content_html;
                        newContentDiv.setAttribute("id", "board_div_child");
                        mypage_board_content.appendChild(newContentDiv);

                        let input_boardImage = document.getElementById(`input_boardImage_${content[i].board_id}`);
                        let div_boardImage = document.getElementById(`div_boardImage_${content[i].board_id}`);
                        stateOpacity(input_boardImage, div_boardImage); // ìƒíƒœì— ë”°ë¼ì„œ íˆ¬ëª…í™” ì‹œí‚¤ê¸° 

                    }
                } else {
                    let comment_html = `<h4>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</h4>`;
                    newContentDiv = document.createElement("div");
                    newContentDiv.innerHTML = comment_html;
                    newContentDiv.setAttribute("id", "board_div_child");
                    mypage_board_content.appendChild(newContentDiv);
                }
            }

            /**ìƒíƒœì— ë”°ë¼ì„œ íˆ¬ëª…í™” ì‹œì¼œì£¼ëŠ” í•¨ìˆ˜ */
            function stateOpacity(input_boardImage, div_boardImage) {

                if (input_boardImage.value == "ì˜ˆì•½" || input_boardImage.value == "íŒë§¤ì™„ë£Œ") {
                    div_boardImage.style.opacity = "0.5";
                }
            }

            /** ê¸°ì¡´ ê²Œì‹œíŒ imageì— ìš”ì†Œê°€ ìˆë‹¤ë©´ ì§€ì›Œì£¼ëŠ” í•¨ìˆ˜
             */
            function deleteDiv() {
                //ê¸°ì¡´ì— ê²Œì‹œíŒ ì´ë¯¸ì§€ê°€ ìˆë‹¤ë©´  ì§€ì›Œì£¼ëŠ” ifë¬¸
                if (newContentDiv != "") {
                    let parent = newContentDiv.parentElement; // í•´ë‹¹ ìì‹íƒœê·¸ ë¶€ëª¨ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°

                    while (parent.firstChild) {
                        parent.removeChild(parent.lastChild); // ë¶€ëª¨ìš”ì†Œ ì•ˆ ìì‹íƒœê·¸ ì‚­ì œ
                    }
                }
            }
            /** ê¸°ì¡´ì— ë„¤ë¹„ê²Œì´ì…˜ë°”ê°€ ìˆë‹¤ë©´
             *  í•œë²ˆ ì§€ì›Œì£¼ëŠ” í•¨ìˆ˜
             */
            function deleteBtnDiv() {
                if (div_new_numberbar_arrow != "") {
                    let parent = div_new_numberbar_arrow.parentElement;

                    while (parent.firstChild) {
                        parent.removeChild(parent.lastChild);
                    };
                }
            }

            /** í˜ì´ì§€ ìˆ«ì ë§‰ëŒ€ ë° ì´ì „,
             * ë‹¤ìŒí˜ì´ì§€ í™”ì‚´í‘œ ìƒì„±
             *  í•˜ëŠ” í•¨ìˆ˜ */
            function makeNavigationBar(content) {
                if (content.end_page != 0) {
                    let html = "";
                    for (let i = content.start_page; i < content.end_page; i++) {
                        html += `
                        <div style="float: left; width: 3%;">
                            <button class="btn btn-outline-success" type="button" id="btn_nav${i}" onclick="btn_nav_arrow_click(this)" value="${i}">${i + 1}</button>
                        </div>
                    `;
                    }
                    div_new_numberbar_arrow = document.createElement("div");
                    div_new_numberbar_arrow.innerHTML = html + `<p style="color:red">í˜ì´ì§€: [${Number(current_page) + 1}]</p>`;
                    div_new_numberbar_arrow.setAttribute("id", "btn_mypage");
                    div_numberbar_arrow.appendChild(div_new_numberbar_arrow);
                } else {
                    let html = `
                    <div style="float: left;">
                    </div>
                    `;
                    div_new_numberbar_arrow = document.createElement("div");
                    div_new_numberbar_arrow.innerHTML = html;
                    div_new_numberbar_arrow.setAttribute("id", "btn_mypage");
                    div_numberbar_arrow.appendChild(div_new_numberbar_arrow);
                }
            }
            /** ë„¤ë¹„ê²Œì´ì…˜ ë°” í´ë¦­ì‹œ ë„¤ë¹„ê²Œì´ì…˜ ë°”
             *  disabled ë§Œë“¤ê³ 
             * ì´ë¯¸ì§€ ë‚´ìš©ë¬¼ ë‹¬ë¼ì§€ê²Œ í•˜ê¸°*/
            function btn_nav_arrow_click(b) {

                current_page = b.value; // í˜„ì¬í˜ì´ì§€ë¥¼ í´ë¦­í•œ ë²„íŠ¼ ê°’ìœ¼ë¡œ ë³€ê²½
                /** ì´ë¯¸ì§€ ë‚´ìš©ë¬¼ ë‹¬ë¼ì§€ê²Œ í•˜ê¸°*/
                btn_getContent(btn_board_state);

            }

            all_getContent();

        </script>
</body>

</html>