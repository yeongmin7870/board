<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <title>ë‚´ê°€ ì“´ ê¸€ë“¤</title>
</head>

<body>
    <% let address=board.result[0].user_address.split(' ');
            address = address[0]+' '+address[1]+' '+address[2];    
        %> <!-- ì£¼ì†Œ ìë¥´ê¸° -->
        <div style="text-align: left; margin-left: 10%; margin-right: 10%; margin-top: 5%;">
            <hr>
            <h4>ë§ˆì´í˜ì´ì§€</h4>
            <button type="button" class="btn btn-outline-primary" onClick="location.href=' /v2/home/0'">í™ˆìœ¼ë¡œ</button>

            <hr>
                <span>
                <% if(board.result[0].user_profile) { %>
                    <img style="width: 30%; height: 30%;" src="/images/board/<%=board.result[0].user_profile%>">
                    <!-- í”„ë¡œíŒŒì¼ -->
                <% } else { %>
                    <img style="width:  30%; height: 30%;" src="/images/profile.png">
                <% } %> 
                <input id="nowNickname" type="hidden" value="<%=board.result[0].nickname%>"> <!-- í˜„ì¬ ëˆ„êµ¬ì˜ ë§ˆì´í˜ì´ì§€ë¥¼ ë³´ê³  ìˆëŠ”ì§€ -->
                <button id="btn_profile"  class="btn btn-outline-secondary">ìˆ˜ì •</button>
                </span>
            <ul>
                <li>ë‹‰ë„¤ì„: <%=board.result[0].nickname%></li> <!-- ë‹‰ë„¤ì„ -->
                <li>ì£¼ì†Œ: <%=address%></li>  <!-- ì£¼ì†Œ -->
            </ul>
            <hr>

            <div id ="btn_group">
                <button type="button" class="btn btn-outline-success" id="btn_all" onclick="buttonDisabled(this)" value="ì „ì²´" disabled>ì „ì²´</button>
                <button type="button" class="btn btn-outline-success" id="btn_sell" onclick="buttonDisabled(this)" value="íŒë§¤">íŒë§¤ì¤‘</button>
                <button type="button" class="btn btn-outline-success" id="btn_reservation" onclick="buttonDisabled(this)" value="ì˜ˆì•½">ì˜ˆì•½ì¤‘</button>
                <button type="button" class="btn btn-outline-success" id="btn_soldout" onclick="buttonDisabled(this)" value="íŒë§¤ì™„ë£Œ">íŒë§¤ì™„ë£Œ</button>
            </div>
            <p>ğŸˆ íŒë§¤ìƒí’ˆë³´ê¸°</p>
            <hr>
                <table>
                        <thead>
                            <div id="mypage_board_content_th"></div>
                        </table>
                    <tbody>
                        <tr>
                            <div style="text-align: center;" id="mypage_board_content">
                                <!--ì´ ì•ˆì€ í•´ë‹¹ ë‹‰ë„¤ì„ ê²Œì‹œíŒ -->
                            </div>
                        </tr>
                    </tbody>
                </table>
                <div style="margin-top: 33%; text-align: center; margin-right: 1%;">
                    <hr>
                        <div id="div_numberbar_arrow"></div>
                    <hr>
                </div>
        </div>

        <script src="/javascripts/cookie.js" type="text/javascript"></script>
        <script src="/javascripts/fetch.js" type="text/javascript"></script>
        <script>
            let token = getCookie('x_auth'); //í† í° êº¼ë‚´ê¸°
            let btn_profile = document.getElementById("btn_profile"); // ìˆ˜ì •ë²„íŠ¼
            let newContentDiv = ""; // ë§ˆì´í˜ì´ì§€ ê²Œì‹œë¬¼ ë‚´ìš© ìì‹ div
            let current_page = 0; // ê²Œì‹œíŒ ë‚´ìš© ë³´ê³  ìˆëŠ” í˜„ì¬ í˜ì´ì§€
            let div_numberbar_arrow = document.getElementById("numberbar_arrow"); // í˜ì´ì§€ ìˆ«ì ë§‰ëŒ€ê¸°ë‘, ì´ì „í˜ì´ì§€, ë‹¤ìŒí˜ì´ì§€ ë²„íŠ¼ div
            let div_new_numberbar_arrow =""; // div_numberbar_arrow ìì‹ div
            const nowNickname = document.getElementById("nowNickname"); //í˜„ì¬ ë‹‰ë„¤ì„ input
            const mypageNickname = nowNickname.value; //ë§ˆì´í˜ì´ì§€ ë‹‰ë„¤ì„
            let mypage_board_content = document.getElementById("mypage_board_content"); // ë§ˆì´í˜ì´ì§€ ê²Œì‹œë¬¼ ë‚´ìš© ë¶€ëª¨ div


            /** í† í°ì„ ë°›ìœ¼ë©´ ë‹‰ë„¤ì„ìœ¼ë¡œ í”„ë¡œí•„ ìˆ˜ì •ê¶Œí•œì„ ì²´í¬ í•´ì£¼ê³ 
             *  ë§ë‹¤ë©´ ìˆ˜ì • íŒì—…ì°½ì„ ë³´ì—¬ì£¼ëŠ” í•¨ìˆ˜
             */
            btn_profile.addEventListener("click", async () => {
                const t = await Post_body("/v1/getnickname?_method=GET", { data: token }); // í† í°ìœ¼ë¡œ ê°€ì ¸ì˜¨ ë‹‰ë„¤ì„
                const tokenNickname = t.nickname;
                if (tokenNickname == mypageNickname) {
                    window.open("/v2/profile-popup", "í”„ë¡œíŒŒì¼ ìˆ˜ì •", "width=400, height=300, top=10, left=10");
                } else {
                    alert("ìì‹ ì˜ ë§ˆì´í˜ì´ì§€ê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— í”„ë¡œíŒŒì¼ì„ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                }
            })
            /** í´ë¦­í•œ ë²„íŠ¼ ì•„ì´ë””ë¥¼ ì…ë ¥ë°›ìœ¼ë©´
             *  í•œë²ˆ ì „ë¶€ ë¹„í™œì„±í™” í’€ì–´ì£¼ê³ 
             *  í´ë¦­í•œ ë²„íŠ¼ì„ ë¹„í™œì„±í™” ì‹œí‚´
             */
            function buttonDisabled(b) {
                const target = document.getElementById(b.id);
                let childBtn = document.getElementById("btn_group").getElementsByTagName('*');
                for (let btn of childBtn) {
                    btn.disabled = false;
                }
                target.disabled = true;

                btn_getContent(target);
            }
            /**ë²„íŠ¼ ëˆ„ë¥´ë©´ í•´ë‹¹ ë‚´ìš©ì„ ê°€ì ¸ì˜´*/
            async function btn_getContent(btn) {
                let url = `/v3/board-mypage-content/${nowNickname.value}?board_state=${btn.value}&&current_page=${current_page}`
                const content = await Get_pathVar(url);
                deleteDiv(); // ê¸°ì¡´ì— ìš”ì†Œê°€ ìˆë‹¤ë©´ ì‚­ì œ
                makeboardContent(content.board.result);
            }

            /** ìµœì´ˆì˜ í•œë²ˆë§Œ ì‹¤í–‰ 
             *  ì „ì²´ ê²Œì‹œíŒ ë‚´ìš© ê°€ì ¸ì˜¤ê¸°
            */
            async function all_getContent() {
                let url = `/v3/board-mypage-content/${nowNickname.value}?board_state=ì „ì²´&&current_page=${current_page}`
                const content = await Get_pathVar(url);

                console.log("í˜ì´ì§•ì²˜ë¦¬"+content.numberbar_arrow.nexPage); //í…ŒìŠ¤íŠ¸

                makeboardContent(content.board.result);
            }
            /** ë§ˆì´í˜ì´ì§€ ê³ ê°ì´ ì‘ì„±í•œ ê²Œì‹œë¬¼ ì¶œë ¥ í•´ì£¼ëŠ” í•¨ìˆ˜*/
            function makeboardContent(content) {
                if (content.length != 0) { //í…Œì´ë¸” í—¤ë“œ
                    let comment_html1 = "";
                    for (let i = 0; i < content.length; i++) {
                        comment_html1 += `
                                <th scope="col">
                                </th>
                        `;
                    }
                    for (let i = 0; i < content.length; i++) { // í…Œì´ë¸” ë³¸ì²´ 
                        let comment_html2 = `
                            <td>
                                <div id="div_boardImage_${content[i].board_id}" style="width:20%; height:20%; float:left; margin-left: 10%;"">
                                    <a href="/v3/board/page/${content[i].board_id}">
                                    <img src="/images/board/${content[i].board_image}" style="width:100%; height:100%;">
                                    <p>${content[i].board_title}</p></a> 
                                    <input type="hidden" value="${content[i].board_state}" id="input_boardImage_${content[i].board_id}">
                                </div>
                            </td>
                        `;

                        newContentDiv = document.createElement("div");
                        newContentDiv.innerHTML = comment_html1 + comment_html2;
                        newContentDiv.setAttribute("id", "board_div_child");
                        mypage_board_content.appendChild(newContentDiv);

                        let input_boardImage = document.getElementById(`input_boardImage_${content[i].board_id}`);
                        let div_boardImage = document.getElementById(`div_boardImage_${content[i].board_id}`);
                        stateOpacity(input_boardImage, div_boardImage); // ìƒíƒœì— ë”°ë¼ì„œ íˆ¬ëª…í™” ì‹œí‚¤ê¸° 
                    }
                } else {
                    console.log("hi");
                    let comment_html = `<h4>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</h4>`;
                    newContentDiv = document.createElement("div");
                    newContentDiv.innerHTML = comment_html;
                    newContentDiv.setAttribute("id", "board_div_child");
                    mypage_board_content.appendChild(newContentDiv);
                }
            }

            /**ìƒíƒœì— ë”°ë¼ì„œ íˆ¬ëª…í™” ì‹œì¼œì£¼ëŠ” í•¨ìˆ˜ */
            function stateOpacity(input_boardImage, div_boardImage) {

                if (input_boardImage.value == "ì˜ˆì•½" || input_boardImage.value == "íŒë§¤ì™„ë£Œ") {
                    div_boardImage.style.opacity = "0.5";
                }
            }

            /** ê¸°ì¡´ divì— ìš”ì†Œê°€ ìˆë‹¤ë©´ ì§€ì›Œì£¼ëŠ” í•¨ìˆ˜
             */
            function deleteDiv() {
                //ê¸°ì¡´ì— ëŒ“ê¸€ì´ ìˆë‹¤ë©´ í•œë²ˆ ì§€ì›Œì£¼ëŠ” ifë¬¸
                if (newContentDiv != "") {
                    let parent = newContentDiv.parentElement; // í•´ë‹¹ ìì‹íƒœê·¸ ë¶€ëª¨ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
                    while (parent.firstChild) {
                        parent.removeChild(parent.lastChild); // ë¶€ëª¨ìš”ì†Œ ì•ˆ ìì‹íƒœê·¸ ì‚­ì œ
                    }
                }
            }

            /** í˜ì´ì§€ ìˆ«ì ë§‰ëŒ€ ë° ì´ì „,
             * ë‹¤ìŒí˜ì´ì§€ í™”ì‚´í‘œ ìƒì„±
             *  í•˜ëŠ” í•¨ìˆ˜ */
            // function makeNavigationBar(){

            // }

            all_getContent();

        </script>
</body>

</html>