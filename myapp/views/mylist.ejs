<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <title>내가 쓴 글들</title>
</head>

<body>
    <% let address=board.result[0].user_address.split(' ');
            address = address[0]+' '+address[1]+' '+address[2];    
        %> <!-- 주소 자르기 -->
        <div style="text-align: left; margin-left: 10%; margin-right: 10%; margin-top: 5%;">
            <h4>마이페이지</h4>
            <hr>
                <span>
                <% if(board.result[0].user_profile) { %>
                    <img style="width: 30%; height: 30%;" src="/images/board/<%=board.result[0].user_profile%>">
                    <!-- 프로파일 -->
                <% } else { %>
                    <img style="width:  30%; height: 30%;" src="/images/profile.png">
                <% } %> 
                <input id="nowNickname" type="hidden" value="<%=board.result[0].nickname%>"> <!-- 현재 누구의 마이페이지를 보고 있는지 -->
                <button id="btn_profile"  class="btn btn-outline-secondary">수정</button>
                </span>
            <ul>
                <li>닉네임: <%=board.result[0].nickname%></li> <!-- 닉네임 -->
                <li>주소: <%=address%></li>  <!-- 주소 -->
            </ul>
            <hr>
    <%  
        if(board.result[0].board_id){ 
    %>
            <p>🐈 판매상품보기</p>
            <button type="button" class="btn btn-outline-success" disabled>전체</button>
            <button type="button" class="btn btn-outline-success">판매중</button>
            <button type="button" class="btn btn-outline-success">예약중</button>
            <button type="button" class="btn btn-outline-success">판매완료</button>
            <hr>
            <div style="text-align: center;">
                <table>
                    <thead>
                        <%for(let i=0; i < board.result.length; i++) { %>
                            <tr>
                                <th scope="col"></th>
                            </tr>
                        <% } %>
                    </thead>
                    <tbody>
                        <tr>
                            <%for(let i=0; i < board.result.length; i++) { %>
                                <td>
                                    <img src="/images/board/<%=board.result[i].board_image%>" style="width:30%; height:30%;">
                                    <p><%=board.result[i].board_title%></p>
                                </td>
                            <% } %>
                        </tr>
                    </tbody>            
                </table>
            </div>    
    <%} else {%>
        <h4> 데이터가 없습니다 </h4>
    <% } %>
        <hr>
        <button type="button" class="btn btn-outline-primary" onClick="location.href=' /v2/home/0'">돌아가기</button>
        </div>
        <script src="/javascripts/cookie.js" type="text/javascript"></script>
        <script src="/javascripts/fetch.js" type="text/javascript"></script>
        <script>
            let token = getCookie('x_auth'); //토큰 꺼내기
            let btn_profile = document.getElementById("btn_profile"); // 수정버튼
            const nowNickname = document.getElementById("nowNickname"); //현재 닉네임 input
            const mypageNickname = nowNickname.value; //마이페이지 닉네임
            
            /** 토큰을 받으면 닉네임으로 프로필 수정권한을 체크 해주고
             *  맞다면 수정 팝업창을 보여주는 함수
             */
            btn_profile.addEventListener("click", async () => {
                const t = await Post_body("/v1/getnickname?_method=GET",{data:token}); // 토큰으로 가져온 닉네임
                const tokenNickname = t.nickname;
                if(tokenNickname == mypageNickname){
                    window.open("/v2/profile-popup", "프로파일 수정", "width=400, height=300, top=10, left=10");
                } else {
                    alert("자신의 마이페이지가 아니기 때문에 프로파일을 수정할 수 없습니다.");
                }
            })
            
        </script>
</body>

</html>